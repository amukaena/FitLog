# FitLog - 데이터 모델 설계

## 1. 개념 모델

```
[DailyWorkout] 1 --- * [WorkoutRecord] * --- 1 [Exercise]
   일일 기록            개별 운동 기록         운동 종목
                            │
                            *
                       [WorkoutSet]
                         세트 기록
```

## 2. 엔티티 정의

### 2.1 Exercise (운동 종목)

미리 등록해두는 운동 종목 목록

| 필드 | 타입 | 설명 |
|------|------|------|
| id | Long (PK) | 고유 식별자 |
| name | String | 운동 이름 (예: 벤치프레스) |
| category | String | 카테고리 (가슴, 등, 어깨, 팔, 하체, 코어) |
| isCustom | Boolean | 사용자 추가 여부 (기본 운동: false) |
| lastUsedAt | Long? | 마지막 사용 시간 (정렬용, null이면 미사용) |
| createdAt | Long | 생성 시간 |

> **정렬 규칙**: 운동 목록은 `lastUsedAt DESC` (최근 사용순)로 정렬. 미사용 운동은 하단에 `createdAt ASC`로 표시.
> **삭제 정책**: 운동 종목은 삭제하지 않음. 안 쓰는 운동은 자연스럽게 목록 하단으로 내려감.

### 2.2 DailyWorkout (일일 운동 기록)

특정 날짜의 전체 운동을 묶는 단위 (복사, 타이틀 관리용)

| 필드 | 타입 | 설명 |
|------|------|------|
| id | Long (PK) | 고유 식별자 |
| date | Long (unique) | 날짜 (epoch millis, 해당 날짜 00:00:00 기준) |
| title | String | 운동 제목 (가슴/삼두, 등/이두 등) |
| memo | String? | 메모 (선택) |
| createdAt | Long | 생성 시간 |
| updatedAt | Long | 수정 시간 |

> **날짜 저장 방식**: timestamp(Long)로 저장하여 정렬/범위 검색 효율화. 화면 표시 시 포맷팅.

### 2.3 WorkoutRecord (운동 기록)

일일 기록 내의 개별 운동 기록

| 필드 | 타입 | 설명 |
|------|------|------|
| id | Long (PK) | 고유 식별자 |
| dailyWorkoutId | Long (FK) | 일일 운동 기록 ID |
| exerciseId | Long (FK) | 운동 종목 ID |
| order | Int | 운동 순서 |
| createdAt | Long | 생성 시간 |

### 2.4 WorkoutSet (세트 기록)

운동 기록 내의 각 세트 정보

| 필드 | 타입 | 설명 |
|------|------|------|
| id | Long (PK) | 고유 식별자 |
| workoutRecordId | Long (FK) | 운동 기록 ID |
| setNumber | Int | 세트 번호 (1, 2, 3...) |
| weight | Float | 무게 (kg) |
| reps | Int | 횟수 |

## 3. 관계도

```
┌─────────────┐       ┌─────────────┐
│  Exercise   │       │DailyWorkout │
│─────────────│       │─────────────│
│ id (PK)     │       │ id (PK)     │
│ name        │       │ date        │
│ category    │       │ title       │
└──────┬──────┘       │ memo        │
       │              └──────┬──────┘
       │ 1                   │ 1
       │                     │
       │ *                   │ *
       │              ┌──────┴──────┐
       └─────────────→│WorkoutRecord│
                      │─────────────│
                      │ id (PK)     │
                      │dailyWorkoutId│──→ DailyWorkout.id
                      │ exerciseId  │──→ Exercise.id
                      │ order       │
                      └──────┬──────┘
                             │ 1
                             │
                             │ *
                      ┌──────┴──────┐
                      │ WorkoutSet  │
                      │─────────────│
                      │ id (PK)     │
                      │ recordId    │──→ WorkoutRecord.id
                      │ setNumber   │
                      │ weight      │
                      │ reps        │
                      └─────────────┘
```

## 4. 인덱스 전략

자주 사용되는 쿼리 성능 최적화를 위한 인덱스 정의:

| 테이블 | 인덱스 | 용도 |
|--------|--------|------|
| DailyWorkout | `date` (UNIQUE) | 날짜별 조회, 범위 검색 (자동 생성) |
| WorkoutRecord | `dailyWorkoutId` | 특정 날짜의 운동 기록 조회 |
| WorkoutSet | `workoutRecordId` | 특정 운동의 세트 목록 조회 |
| Exercise | `category` | 카테고리별 필터링 |
| Exercise | `lastUsedAt` | 최근 사용순 정렬 |

> **Room 구현 시**: `@Index` 어노테이션 사용
> ```kotlin
> @Entity(indices = [Index(value = ["dailyWorkoutId"])])
> data class WorkoutRecordEntity(...)
> ```

## 5. 기본 데이터 (운동 종목)

앱 초기 설치 시 제공되는 기본 운동 목록:

### 가슴 (Chest)
- 벤치프레스
- 인클라인 벤치프레스
- 덤벨 플라이
- 케이블 크로스오버
- 푸시업

### 등 (Back)
- 데드리프트
- 랫풀다운
- 바벨로우
- 시티드로우
- 풀업

### 어깨 (Shoulder)
- 오버헤드프레스
- 사이드 레터럴 레이즈
- 프론트 레이즈
- 페이스풀

### 팔 (Arms)
- 바벨컬
- 덤벨컬
- 트라이셉스 익스텐션
- 케이블 푸시다운
- 해머컬

### 하체 (Legs)
- 스쿼트
- 레그프레스
- 레그익스텐션
- 레그컬
- 런지
- 카프레이즈

### 코어 (Core)
- 플랭크
- 크런치
- 레그레이즈
- 러시안 트위스트

## 6. 백업 데이터 형식 (JSON)

> **날짜 형식**: DB에는 timestamp(Long)로 저장하지만, 백업 JSON에서는 가독성을 위해 `"yyyy-MM-dd"` 문자열로 변환하여 저장. import/export 시 변환 처리.
> **암호화**: 별도 암호화 없이 평문 JSON으로 저장 (민감 정보 없음)
> **복원 정책**: 백업 복원 시 기존 데이터 전체 삭제 후 덮어쓰기 (병합 없음)

```json
{
  "version": 1,
  "exportedAt": "2024-01-15T10:30:00",
  "exercises": [
    {
      "id": 1,
      "name": "벤치프레스",
      "category": "가슴"
    },
    {
      "id": 2,
      "name": "트라이셉스 익스텐션",
      "category": "팔"
    }
  ],
  "dailyWorkouts": [
    {
      "id": 1,
      "date": "2024-01-15",
      "title": "가슴/삼두",
      "memo": "오늘 컨디션 좋음",
      "records": [
        {
          "id": 1,
          "exerciseId": 1,
          "order": 1,
          "sets": [
            { "setNumber": 1, "weight": 60.0, "reps": 10 },
            { "setNumber": 2, "weight": 70.0, "reps": 8 },
            { "setNumber": 3, "weight": 80.0, "reps": 6 }
          ]
        },
        {
          "id": 2,
          "exerciseId": 2,
          "order": 2,
          "sets": [
            { "setNumber": 1, "weight": 20.0, "reps": 12 },
            { "setNumber": 2, "weight": 20.0, "reps": 10 }
          ]
        }
      ]
    }
  ]
}
```
